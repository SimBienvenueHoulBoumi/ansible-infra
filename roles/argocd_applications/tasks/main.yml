---
# Créer les Application ArgoCD à partir de argocd_applications (group_vars)

- name: Construire les définitions Application
  ansible.builtin.include_tasks: build_definitions.yml

- name: Créer ou mettre à jour les applications ArgoCD
  community.kubernetes.k8s:
    state: present
    definition: "{{ item }}"
  loop: "{{ argocd_application_definitions }}"
  loop_control:
    label: "{{ item.metadata.name }}"
  environment: "{{ {'KUBECONFIG': kubeconfig} if kubeconfig is defined and kubeconfig else {} }}"
